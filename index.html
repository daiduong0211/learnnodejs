<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý nhà xe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .tabButton {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .tabButton button {
            flex: 1;
            padding: 15px 20px;
            font-size: 18px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .tab-content {
            display: none;
            margin-top: 20px;
        }

        .active {
            display: block;
        }

        .table {
            width: 100%;
            table-layout: fixed;
            /* Các cột sẽ có độ rộng bằng nhau */
        }

        .table th,
        .table td {
            text-align: center;
            /* Căn giữa chữ trong các cột */
            vertical-align: middle;
            /* Đảm bảo chữ được căn giữa theo chiều dọc */
        }

        h3 {
            margin-left: 20px;
        }
    </style>
</head>

<body>

    <div class="main">
        <div style="text-align: center; font-size: 20px; font-weight: bold; margin-top: 20px;">Quản lý nhà xe</div>
        <div class="tabButton">
            <button type="button" class="btn btn-primary" onclick="showTab('drivers')">Tài Xế</button>
            <button type="button" class="btn btn-secondary" onclick="showTab('routes')">Tuyến Đường</button>
            <button type="button" class="btn btn-success" onclick="showTab('cars')">Xe</button>
            <button type="button" class="btn btn-danger" onclick="showTab('trips')">Chuyến Đi</button>
            <button type="button" class="btn btn-warning" onclick="showTab('revenue')">Doanh thu xe</button>
            <button type="button" class="btn btn-info" onclick="showTab('salary')">Lương tài xế</button>
            <button type="button" class="btn btn-dark" onclick="showTab('maintenance-status')">Bảo dưỡng xe</button>
        </div>
    </div>

    <!-- Bảng Tài Xế -->
    <div id="drivers" class="tab-content">
        <table class="table" id="driverTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Tên</th>
                    <th scope="col">Số Điện Thoại</th>
                    <th scope="col">CMND</th>
                    <th scope="col">Ngày Sinh</th>
                    <th scope="col">Loại Bằng Lái</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sẽ được điền tại đây -->
            </tbody>
        </table>
    </div>

    <!-- Bảng bảo trì -->
    <div id="maintenance-status" class="tab-content">
        <!-- Bảng Xe Chưa Tới Hạn -->
        <h3>Xe Chưa Tới Hạn</h3>
        <table class="table" id="onTimeTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Biển Số</th>
                    <th scope="col">Màu Xe</th>
                    <th scope="col">Hãng Sản Xuất</th>
                    <th scope="col">Năm Sản Xuất</th>
                    <th scope="col">Model</th>
                    <th scope="col">Số Ghế</th>
                    <th scope="col">Ngày Bảo Dưỡng Gần Nhất</th>
                    <th scope="col">Ngày Bảo Dưỡng Tiếp</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>

        <!-- Bảng Xe Quá Hạn -->
        <h3>Xe Quá Hạn</h3>
        <table class="table" id="overdueTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Biển Số</th>
                    <th scope="col">Màu Xe</th>
                    <th scope="col">Hãng Sản Xuất</th>
                    <th scope="col">Năm Sản Xuất</th>
                    <th scope="col">Model</th>
                    <th scope="col">Số Ghế</th>
                    <th scope="col">Ngày Bảo Dưỡng Gần Nhất</th>
                    <th scope="col">Ngày Bảo Dưỡng Tiếp</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>


    <!-- Bảng Lương Tài Xế -->
    <div id="salary" class="tab-content">
        <table class="table" id="salaryTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">ID Tài Xế</th>
                    <th scope="col">Tên</th>
                    <th scope="col">CMND</th>
                    <th scope="col">Số Bằng Lái</th>
                    <th scope="col">Loại Bằng Lái</th>
                    <th scope="col">Địa Chỉ</th>
                    <th scope="col">Ngày Sinh</th>
                    <th scope="col">Thâm Niên (năm)</th>
                    <th scope="col">Số Điện Thoại</th>
                    <th scope="col">Tổng Lương</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sẽ được điền tại đây -->
            </tbody>
        </table>
    </div>

    <!-- Bảng Tuyến Đường -->
    <div id="routes" class="tab-content">
        <table class="table" id="routeTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Điểm Đầu</th>
                    <th scope="col">Điểm Cuối</th>
                    <th scope="col">Độ Dài (km)</th>
                    <th scope="col">Độ Phức Tạp</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sẽ được điền tại đây -->
            </tbody>
        </table>
    </div>

    <!-- Bảng Xe -->
    <div id="cars" class="tab-content">
        <table class="table" id="carTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Biển Số</th>
                    <th scope="col">Màu Xe</th>
                    <th scope="col">Hãng Sản Xuất</th>
                    <th scope="col">Model</th>
                    <th scope="col">Số Ghế</th>
                    <th scope="col">Năm Sử Dụng</th>
                    <th scope="col">Ngày Bảo Dưỡng Cuối</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sẽ được điền tại đây -->
            </tbody>
        </table>
    </div>

    <!-- Bảng Chuyến Đi -->
    <div id="trips" class="tab-content">
        <table class="table" id="tripTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Mã Chuyến</th>
                    <th scope="col">Tuyến Đường</th>
                    <th scope="col">Xe</th>
                    <th scope="col">Lái Xe</th>
                    <th scope="col">Phụ Xe</th>
                    <th scope="col">Số Khách</th>
                    <th scope="col">Giá Vé</th>
                    <th scope="col">Ngày Đi</th>
                    <th scope="col">Ngày Về</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sẽ được điền tại đây -->
            </tbody>
        </table>
    </div>

    <!-- Bảng Doanh Thu -->
    <div id="revenue" class="tab-content">
        <div style="margin: 20px; font-family: Arial, sans-serif;">
            <label for="startDate" style="font-weight: bold; margin-right: 10px;">Ngày Bắt Đầu:</label>
            <input type="date" id="startDate" style="padding: 8px; margin-right: 20px; border: 1px solid #ccc; border-radius: 4px;">
        
            <label for="endDate" style="font-weight: bold; margin-right: 10px;">Ngày Kết Thúc:</label>
            <input type="date" id="endDate" style="padding: 8px; margin-right: 20px; border: 1px solid #ccc; border-radius: 4px;">
        
            <button id="loadRevenueBtn" style="padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s;">Tải Dữ Liệu Doanh Thu</button>
        </div>
        
        <table class="table" id="revenueTable">
            <thead>
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Bus ID</th>
                    <th scope="col">Biển Số</th>
                    <th scope="col">Màu xe</th>
                    <th scope="col">Hãng sản Xuất</th>
                    <th scope="col">Đời Xe</th>
                    <th scope="col">Model</th>
                    <th scope="col">Số ghế</th>
                    <th scope="col">Doanh thu</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sẽ được điền tại đây -->
            </tbody>
        </table>
    </div>

    <script>
        // Hàm để hiển thị tab tương ứng
        function showTab(tabId) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });
            const selectedTab = document.getElementById(tabId);
            selectedTab.classList.add('active');

            if (tabId === 'drivers') {
                loadDriverData();
            } else if (tabId === 'routes') {
                loadRouteData();
            } else if (tabId === 'cars') {
                loadCarData();
            } else if (tabId === 'trips') {
                loadTripData();
            }
            else if (tabId === 'revenue') {
                // loadRevenueData();
            }
            else if (tabId === 'salary') {
                loadSalaryData();
            }
            else if (tabId === 'maintenance-status') {
                loadMaintenanceData();
            }

        }

        // Hàm để tải dữ liệu Tài Xế
        function loadDriverData() {
            fetch('http://localhost:3000/api/drivers')
                .then(response => response.json())
                .then(data => {
                    const driverTableBody = document.querySelector('#driverTable tbody');
                    driverTableBody.innerHTML = '';
                    data.result.forEach((driver, index) => {
                        const row = `
                        <tr>
                            <th scope="row">${index + 1}</th>
                            <td>${driver.ten}</td>
                            <td>${driver.sdt}</td>
                            <td>${driver.CMT}</td>
                            <td>${new Date(driver.ngay_sinh).toLocaleDateString()}</td>
                            <td>${driver.loai_bang_lai}</td>
                        </tr>
                    `;
                        driverTableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu tài xế:', error);
                });
        }

        // Hàm để tải dữ liệu Tuyến Đường
        function loadRouteData() {
            fetch('http://localhost:3000/api/routes')
                .then(response => response.json())
                .then(data => {
                    const routeTableBody = document.querySelector('#routeTable tbody');
                    routeTableBody.innerHTML = '';
                    data.result.forEach((route, index) => {
                        const row = `
                        <tr>
                            <th scope="row">${index + 1}</th>
                            <td>${route.diem_dau}</td>
                            <td>${route.diem_cuoi}</td>
                            <td>${route.do_dai}</td>
                            <td>${route.do_phuc_tap}</td>
                        </tr>
                    `;
                        routeTableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu tuyến đường:', error);
                });
        }

        // Hàm để tải dữ liệu Xe
        function loadCarData() {
            fetch('http://localhost:3000/api/buses')
                .then(response => response.json())
                .then(data => {
                    const carTableBody = document.querySelector('#carTable tbody');
                    carTableBody.innerHTML = '';
                    data.result.forEach((car, index) => {
                        const row = `
                        <tr>
                            <th scope="row">${index + 1}</th>
                            <td>${car.bien_so}</td>
                            <td>${car.mau_xe}</td>
                            <td>${car.hang_san_xuat}</td>
                            <td>${car.model}</td>
                            <td>${car.so_ghe}</td>
                            <td>${car.so_nam_su_dung}</td>
                            <td>${new Date(car.ngay_bao_duong_cuoi).toLocaleDateString()}</td>
                        </tr>
                    `;
                        carTableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu xe:', error);
                });
        }

        // Hàm để tải dữ liệu Chuyến Đi
        function loadTripData() {
            fetch('http://localhost:3000/api/trips')
                .then(response => response.json())
                .then(data => {
                    const tripTableBody = document.querySelector('#tripTable tbody');
                    tripTableBody.innerHTML = '';
                    data.result.forEach((trip, index) => {
                        const row = `
                        <tr>
                            <th scope="row">${index + 1}</th>
                            <td>${trip.ma_chuyen}</td>
                            <td>${trip.route_id}</td>
                            <td>${trip.bus_id}</td>
                            <td>${trip.lai_xe_id}</td>
                            <td>${trip.phu_xe_id}</td>
                            <td>${trip.so_khach}</td>
                            <td>${trip.gia_ve}</td>
                            <td>${new Date(trip.ngay_di).toLocaleDateString()}</td>
                            <td>${new Date(trip.ngay_ve).toLocaleDateString()}</td>
                        </tr>
                    `;
                        tripTableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu chuyến đi:', error);
                });
        }

        // Hàm tải dữ liệu doanh thu với ngày bắt đầu và ngày kết thúc
        function loadRevenueData(startDate, endDate) {
            // Tạo URL với tham số ngày bắt đầu và kết thúc
            const url = `http://localhost:3000/api/buses/revenue?startDate=${startDate}&endDate=${endDate}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const revenueTableBody = document.querySelector('#revenueTable tbody');
                    revenueTableBody.innerHTML = ''; // Xóa nội dung cũ
                    data.result.forEach((revenue, index) => {
                        const row = `
                    <tr>
                        <th scope="row">${index + 1}</th>
                        <td>${revenue.bus_id}</td>
                        <td>${revenue.bus_info.bien_so}</td>
                        <td>${revenue.bus_info.mau_xe}</td>
                        <td>${revenue.bus_info.hang_san_xuat}</td>
                        <td>${revenue.bus_info.doi_xe}</td>
                        <td>${revenue.bus_info.model}</td>
                        <td>${revenue.bus_info.so_ghe}</td>
                        <td>${revenue.total_revenue}</td>
                    </tr>
                `;
                        revenueTableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu doanh thu:', error);
                });
        }

        // Gắn sự kiện click cho nút tải dữ liệu
        document.getElementById('loadRevenueBtn').addEventListener('click', function() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        // Kiểm tra điều kiện
        if (!startDate || !endDate) {
            window.alert('Vui lòng chọn cả Ngày Bắt Đầu và Ngày Kết Thúc.'); // Hiển thị thông báo
            return; // Ngừng thực hiện nếu không có ngày
        }

        // Gọi hàm tải dữ liệu doanh thu với ngày bắt đầu và kết thúc đã chọn
        loadRevenueData(startDate, endDate);
         });

        // hàm tải dữ liệu lương tài xế
        function loadSalaryData() {
            fetch('http://localhost:3000/api/drivers/salary')
                .then(response => response.json())
                .then(data => {
                    const salaryTableBody = document.querySelector('#salaryTable tbody');
                    salaryTableBody.innerHTML = '';
                    data.result.forEach((salary, index) => {
                        console.log(revenue)
                        const row = `
                        <tr>
                            <th scope="row">${index + 1}</th>
                            <td>${salary.driver_id}</td>
                            <td>${salary.ten}</td>
                            <td>${salary.CMT}</td>
                            <td>${salary.so_bang_lai}</td>
                            <td>${salary.loai_bang_lai}</td>
                            <td>${salary.dia_chi}</td>
                            <td>${new Date(salary.ngay_sinh).toLocaleDateString('vi-VN')}</td>
                            <td>${salary.tham_nien}</td>
                            <td>${salary.sdt}</td>
                            <td>${salary.total_salary}</td>
                        </tr>
                    `;
                        salaryTableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu chuyến đi:', error);
                });
        }

        // Hàm tải dữ liệu bảo trì
        function loadMaintenanceData() {
            fetch('http://localhost:3000/api/buses/maintenance-status')
                .then(response => response.json())
                .then(data => {
                    // Lấy tbody cho bảng xe chưa tới hạn
                    const onTimeTableBody = document.querySelector('#onTimeTable tbody');
                    onTimeTableBody.innerHTML = ''; // Xóa nội dung cũ

                    // Hiển thị dữ liệu cho bảng xe chưa tới hạn
                    data.result[0].con_han.forEach((bus, index) => {
                        const row = `
                    <tr>
                        <th scope="row">${index + 1}</th>
                        <td>${bus.bien_so}</td>
                        <td>${bus.mau_xe}</td>
                        <td>${bus.hang_san_xuat}</td>
                        <td>${bus.doi_xe}</td>
                        <td>${bus.model}</td>
                        <td>${bus.so_ghe}</td>
                        <td>${new Date(bus.ngay_bao_duong_cuoi).toLocaleDateString('vi-VN')}</td>
                        <td>${new Date(bus.trip_info.next_maintenance_date).toLocaleDateString('vi-VN')}</td>
                    </tr>
                `;
                        onTimeTableBody.innerHTML += row;
                    });

                    // Lấy tbody cho bảng xe quá hạn
                    const overdueTableBody = document.querySelector('#overdueTable tbody');
                    overdueTableBody.innerHTML = ''; // Xóa nội dung cũ

                    // Hiển thị dữ liệu cho bảng xe quá hạn
                    data.result[0].qua_han.forEach((bus, index) => {
                        const row = `
                    <tr>
                        <th scope="row">${index + 1}</th>
                        <td>${bus.bien_so}</td>
                        <td>${bus.mau_xe}</td>
                        <td>${bus.hang_san_xuat}</td>
                        <td>${bus.doi_xe}</td>
                        <td>${bus.model}</td>
                        <td>${bus.so_ghe}</td>
                        <td>${new Date(bus.ngay_bao_duong_cuoi).toLocaleDateString('vi-VN')}</td>
                        <td>${new Date(bus.trip_info.next_maintenance_date).toLocaleDateString('vi-VN')}</td>
                    </tr>
                `;
                        overdueTableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu bảo trì:', error);
                });
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>